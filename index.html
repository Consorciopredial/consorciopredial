<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Ativos - Profissional</title>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #667eea;
            --success: #10b981;
            --danger: #ef4444;
            --info: #06b6d4;
            --bg: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text: #f1f5f9;
            --text-muted: #cbd5e1;
            --border: #475569;
            --orange: #FF8C42;
            --teal: #4ECDC4;
            --bg-gradient: linear-gradient(135deg, var(--bg) 0%, #1a1f3a 100%);
            --header-color-1: #667eea;
            --header-color-2: #06b6d4;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-gradient); color: var(--text); min-height: 100vh; }
        .tabs-container { display: flex; background: var(--surface); border-bottom: 2px solid var(--border); padding: 0; transition: all 0.3s; }
        .tabs-container.hidden { transform: translateY(-100%); border: none; }
        .tab-button { flex: 1; padding: 18px; background: var(--surface); border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.5px; }
        .tab-button:hover { background: var(--surface-light); color: var(--text); }
        .tab-button.active { background: var(--primary); color: white; border-bottom: 4px solid #764ba2; }
        .tab-content { display: none; min-height: calc(100vh - 60px); overflow-y: auto; }
        .tab-content.active { display: block; }
        .dashboard-container { padding: 20px; }
        .max-width { max-width: 2000px; margin: 0 auto; }
        
        .upload-section { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); padding: 40px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid var(--border); position: relative; overflow: hidden; }
        .upload-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), #764ba2, var(--info)); }
        .upload-content { display: grid; grid-template-columns: 1fr; gap: 40px; position: relative; z-index: 1; }
        .upload-item { text-align: center; }
        .upload-item h3 { font-size: 18px; margin-bottom: 12px; color: var(--primary); font-weight: 600; }
        .upload-item p { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }
        .upload-label { display: inline-block; padding: 12px 28px; background: linear-gradient(135deg, var(--primary), #5a67d8); color: white; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 4px 16px rgba(102,126,234,0.3); }
        .upload-label:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.4); }
        .file-name { margin-top: 12px; font-size: 13px; color: var(--success); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
        .last-update { margin-top: 8px; font-size: 12px; color: var(--text-muted); }
        .error, .success { padding: 15px; border-radius: 8px; margin: 10px 0; display: none; font-size: 14px; }
        .error { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); }
        .success { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); color: var(--success); }
        
        header { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); padding: 40px; border-radius: 16px; margin-bottom: 40px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid var(--border); position: relative; overflow: hidden; display: none; }
        header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--success), var(--info)); }
        header h1 { font-size: 32px; margin-bottom: 8px; background: linear-gradient(135deg, var(--primary), var(--info)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 30px; }
        .stat-item { background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        .stat-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .stat-value { font-size: 28px; font-weight: 700; color: var(--primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .filter-section { background: var(--surface); padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border); display: none; gap: 15px; align-items: center; flex-wrap: wrap; }
        .filter-section.active { display: flex; }
        .filter-group { display: flex; align-items: center; gap: 8px; }
        .filter-group label { font-size: 13px; color: var(--text-muted); font-weight: 500; min-width: 80px; white-space: nowrap; }
        .filter-group select { background: var(--surface-light); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500; min-width: 150px; }
        .filter-group select:focus { border-color: var(--primary); outline: none; }
        .filter-group button { padding: 8px 16px; background: var(--orange); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s; margin-left: auto; }
        .filter-group button:hover { background: #E67E22; transform: translateY(-2px); }
        
        .metrics-grid { display: none; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .metrics-grid.active { display: grid; }
        .metric-card { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); padding: 25px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 1px solid var(--border); position: relative; overflow: hidden; }
        .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--primary), var(--info)); }
        .metric-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .metric-value { font-size: 32px; font-weight: 700; color: var(--primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .charts-grid { display: none; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-bottom: 40px; }
        .charts-grid.active { display: grid; }
        .chart-card { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); padding: 30px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid var(--border); }
        .chart-card h3 { font-size: 16px; margin-bottom: 20px; color: var(--text); font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chart-container { position: relative; height: 320px; }
        
        .table-card { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); border-radius: 16px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid var(--border); margin-bottom: 40px; display: none; }
        .table-card.active { display: block; }
        .table-header { padding: 30px; border-bottom: 1px solid var(--border); }
        .table-header h3 { font-size: 16px; color: var(--text); font-weight: 600; }
        .table-header p { font-size: 12px; color: var(--text-muted); margin-top: 8px; }
        .status-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .status-table th { background: rgba(102, 126, 234, 0.1); padding: 16px; text-align: left; color: var(--primary); font-weight: 600; border-bottom: 2px solid var(--border); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .status-table td { padding: 14px 16px; border-bottom: 1px solid var(--border); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .badge-orange { background: rgba(255, 140, 66, 0.2); color: var(--orange); }
        .badge-teal { background: rgba(78, 205, 196, 0.2); color: var(--teal); }
        .no-data { text-align: center; padding: 60px 20px; color: var(--text-muted); font-size: 16px; }
        .upload-input { display: none; }
        
        .painel-fullscreen { width: 100%; height: 100vh; display: flex; flex-direction: column; background: var(--bg-gradient); overflow: hidden; }
        .painel-header { background: linear-gradient(90deg, var(--header-color-1), var(--header-color-2)); padding: var(--header-padding, 15px 25px); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 8px 32px rgba(0,0,0,0.3); flex-shrink: 0; }
        .painel-logo { height: 40px; max-width: 100px; object-fit: contain; }
        .painel-title { flex: 1; margin-left: 20px; font-size: var(--header-size, 28px); font-weight: 700; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .painel-controls { display: flex; gap: 10px; align-items: center; }
        .painel-timestamp { font-size: var(--timestamp-size, 16px); color: rgba(255,255,255,0.9); font-weight: 600; white-space: nowrap; }
        .painel-exit-btn { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.4); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s; white-space: nowrap; }
        .painel-exit-btn:hover { background: rgba(255, 255, 255, 0.3); border-color: rgba(255, 255, 255, 0.6); transform: translateY(-2px); }
        
        .painel-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: var(--metrics-gap, 12px); padding: var(--metrics-padding, 15px 25px); background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(51, 65, 85, 0.8) 100%); flex-shrink: 0; max-height: 130px; overflow-y: auto; }
        .painel-metric { background: rgba(102, 126, 234, 0.15); border: 2px solid var(--primary); padding: var(--metric-padding, 12px); border-radius: 10px; text-align: center; flex-shrink: 0; min-width: 120px; }
        .painel-metric-label { font-size: var(--metric-label-size, 11px); color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
        .painel-metric-value { font-size: var(--metric-value-size, 28px); font-weight: 700; color: var(--primary); text-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .painel-metric.efficiency { border-color: #10b981; }
        .painel-metric.efficiency.danger { border-color: #ef4444; }
        .painel-metric.efficiency .painel-metric-value { color: #10b981; }
        .painel-metric.efficiency.danger .painel-metric-value { color: #ef4444; }
        
        .painel-content { flex: 1; display: flex; gap: var(--content-gap, 12px); padding: var(--content-padding, 20px 25px); overflow: hidden; }
        .painel-chart { flex: 1; background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); border-radius: 10px; padding: var(--chart-padding, 15px); box-shadow: 0 12px 48px rgba(0,0,0,0.4); border: 2px solid var(--border); display: flex; flex-direction: column; }
        .painel-chart h3 { font-size: var(--chart-title-size, 20px); color: var(--text); margin-bottom: 12px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .painel-chart-container { flex: 1; position: relative; min-height: 0; }
        
        .painel-info { flex: 0 0 var(--info-width, 260px); display: flex; flex-direction: column; gap: var(--info-gap, 12px); }
        .painel-info-card { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); border-radius: 10px; padding: var(--info-padding, 12px); box-shadow: 0 12px 48px rgba(0,0,0,0.4); border: 2px solid var(--border); flex: 1; overflow: hidden; display: flex; flex-direction: column; }
        .painel-info-card h4 { font-size: var(--info-title-size, 11px); color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .painel-info-item { display: flex; justify-content: space-between; align-items: center; margin: 3px 0; font-size: var(--info-text-size, 12px); gap: 6px; min-height: 18px; }
        .painel-info-label { color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; min-width: 0; }
        .painel-info-value { font-weight: 700; color: var(--primary); font-size: var(--info-value-size, 14px); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 0 0 auto; }
        .painel-timer { text-align: center; font-size: 10px; color: var(--text-muted); margin-top: auto; padding-top: 4px; }
        
        .config-container { max-width: 1400px; margin: 0 auto; padding: 30px; }
        .config-section { background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%); padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 1px solid var(--border); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .config-section h3 { font-size: 18px; margin-bottom: 20px; color: var(--primary); font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .section-icon { font-size: 24px; }
        .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .config-item { display: flex; flex-direction: column; gap: 6px; }
        .config-item label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .config-item input[type="color"] { height: 40px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; }
        .config-item input[type="file"] { padding: 8px; background: var(--surface-light); border: 1px solid var(--border); color: var(--text); border-radius: 8px; font-size: 12px; cursor: pointer; }
        .config-item input[type="number"], .config-item input[type="text"], .config-item select { padding: 10px; background: var(--surface-light); border: 1px solid var(--border); color: var(--text); border-radius: 8px; font-size: 13px; }
        .config-item input:focus, .config-item select:focus { border-color: var(--primary); outline: none; }
        .config-checkbox { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--surface-light); border-radius: 8px; border: 1px solid var(--border); cursor: pointer; }
        .config-checkbox input[type="checkbox"] { cursor: pointer; width: 18px; height: 18px; }
        .config-checkbox label { cursor: pointer; margin: 0; font-size: 13px; color: var(--text); white-space: nowrap; }
        .config-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 20px; }
        .config-button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s; }
        .config-button.primary { background: linear-gradient(135deg, var(--primary), #5a67d8); color: white; }
        .config-button.primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .config-button.secondary { background: var(--orange); color: white; }
        .config-button.secondary:hover { background: #E67E22; transform: translateY(-2px); }
        .config-info { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); padding: 12px; border-radius: 8px; font-size: 12px; color: var(--text); margin-top: 15px; line-height: 1.4; }
        .logo-preview { height: 40px; max-width: 100px; border-radius: 8px; border: 1px solid var(--border); object-fit: contain; }
        
        .theme-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
        .theme-btn { padding: 15px; border: 2px solid var(--border); background: var(--surface-light); color: var(--text); border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s; text-align: center; }
        .theme-btn:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .theme-preview { width: 100%; height: 30px; border-radius: 6px; margin-bottom: 8px; }
        
        @media (max-width: 1400px) {
            .charts-grid { grid-template-columns: 1fr; }
            .painel-content { flex-direction: column; }
            .painel-info { flex: 0 0 auto; flex-direction: row; max-height: 85px; }
            .painel-info-card { flex: 1; }
        }
        @media (max-width: 768px) {
            .upload-content { grid-template-columns: 1fr; }
            .header-stats { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: 1fr; }
            .painel-metrics { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="tabs-container">
        <button class="tab-button active" onclick="switchTab('dashboard')">üìä DASHBOARD</button>
        <button class="tab-button" onclick="switchTab('painel')">üñ•Ô∏è PAINEL</button>
        <button class="tab-button" onclick="switchTab('config')">‚öôÔ∏è CONFIG</button>
    </div>

    <div id="dashboard" class="tab-content active">
        <div class="dashboard-container"><div class="max-width">
            <div class="upload-section">
                <div class="upload-content">
                    <div class="upload-item">
                        <h3>üìã Relat√≥rio</h3>
                        <p>Arquivo com aberturas e encerramentos</p>
                        <input type="file" id="fileRelatorio" class="upload-input" accept=".xlsx,.xls,.csv">
                        <label for="fileRelatorio" class="upload-label">Selecionar</label>
                        <div class="file-name" id="fileNameRelatorio" title=""></div>
                        <div class="last-update" id="timeRelatorio"></div>
                    </div>
                </div>
                <div class="error" id="error"></div>
                <div class="success" id="success"></div>
            </div>

            <header id="header">
                <h1>üìä Dashboard</h1>
                <div class="header-stats">
                    <div class="stat-item"><div class="stat-label">Aberturas</div><div class="stat-value" id="totalAberturas">0</div></div>
                    <div class="stat-item"><div class="stat-label">Encerrados</div><div class="stat-value" id="totalEncerrados">0</div></div>
                    <div class="stat-item"><div class="stat-label">Efici√™ncia</div><div class="stat-value" id="taxaResolucao">0%</div></div>
                    <div class="stat-item"><div class="stat-label">Tempo (h)</div><div class="stat-value" id="tempoMedio">0h</div></div>
                </div>
            </header>

            <div class="filter-section" id="filterSection">
                <div class="filter-group"><label>M√™s:</label><select id="mesFilter" onchange="onMesChange()"><option value="">Selecionar...</option></select></div>
                <div class="filter-group"><label>Dia:</label><select id="diaFilter" onchange="updateAllCharts()"><option value="">Todos</option></select></div>
                <div class="filter-group"><label>Ativo:</label><select id="ativoFilter" onchange="updateAllCharts()"><option value="">Todos</option></select></div>
                <div class="filter-group"><button onclick="clearAllFilters()">üîÑ Limpar</button></div>
            </div>

            <div class="metrics-grid" id="metricsGrid">
                <div class="metric-card"><div class="metric-label">üî¥ Abertos</div><div class="metric-value" id="abertosMetrica">0</div></div>
                <div class="metric-card"><div class="metric-label">‚úÖ Resolvidos</div><div class="metric-value" id="resolvidosMetrica">0</div></div>
                <div class="metric-card"><div class="metric-label">‚è±Ô∏è Tempo</div><div class="metric-value" id="slaMedia">0h</div></div>
                <div class="metric-card"><div class="metric-label">üìà Efici√™ncia</div><div class="metric-value" id="produtividade">0%</div></div>
            </div>

            <div class="charts-grid" id="chartsGrid">
                <div class="chart-card"><h3 id="chart1Title">Abertos vs Encerrados - Dia</h3><div class="chart-container"><canvas id="chart1"></canvas></div></div>
                <div class="chart-card"><h3 id="chart2Title">Consolidado - M√™s</h3><div class="chart-container"><canvas id="chart2"></canvas></div></div>
                <div class="chart-card"><h3>Tempo M√©dio (h)</h3><div class="chart-container"><canvas id="chart3"></canvas></div></div>
                <div class="chart-card"><h3>Taxa por Ativo</h3><div class="chart-container"><canvas id="chart4"></canvas></div></div>
            </div>

            <div class="table-card" id="tableCard">
                <div class="table-header">
                    <h3 id="resumoTitle">üìã Resumo</h3>
                    <p id="lastUpdateText">√öltima atualiza√ß√£o: -</p>
                </div>
                <table class="status-table"><thead><tr><th>Ativo</th><th>Abertos</th><th>Resolvidos</th><th>Efici√™ncia %</th><th>Tempo (h)</th><th id="metaLabel">Meta: 95%</th></tr></thead><tbody id="summaryTable"></tbody></table>
            </div>

            <div class="no-data" id="noDataMessage"><p>üëá Selecione o arquivo acima</p></div>
        </div></div>
    </div>

    <div id="painel" class="tab-content">
        <div class="painel-fullscreen">
            <div class="painel-header">
                <div style="display: flex; align-items: center; flex: 1; min-width: 0;">
                    <img id="painelLogoImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='white' width='100' height='100'/%3E%3Ctext x='50' y='55' font-size='50' fill='black' text-anchor='middle' font-weight='bold'%3Eüìä%3C/text%3E%3C/svg%3E" class="painel-logo">
                    <div class="painel-title" id="painelTitle">Painel de Ativos</div>
                </div>
                <div class="painel-controls">
                    <div class="painel-timestamp" id="painelTimestamp">00:00:00</div>
                    <button class="painel-exit-btn" onclick="exitPainel()">üì§ Sair (ESC)</button>
                </div>
            </div>

            <div class="painel-metrics" id="painelMetricsContainer" style="display: none;">
                <div class="painel-metric" id="metricAbertos" style="display: none;"><div class="painel-metric-label" id="labelAbertos">Abertos</div><div class="painel-metric-value" id="painelAbertos">0</div></div>
                <div class="painel-metric" id="metricResolvidos" style="display: none;"><div class="painel-metric-label" id="labelResolvidos">Resolvidos</div><div class="painel-metric-value" id="painelResolvidos">0</div></div>
                <div class="painel-metric" id="metricMeta" style="display: none;"><div class="painel-metric-label" id="labelMeta">Meta</div><div class="painel-metric-value" id="painelMeta">95%</div></div>
                <div class="painel-metric" id="metricTempo" style="display: none;"><div class="painel-metric-label" id="labelTempo">Tempo</div><div class="painel-metric-value" id="painelTempo">0h</div></div>
                <div class="painel-metric efficiency" id="metricEfficiency" style="display: none;"><div class="painel-metric-label" id="labelEfficiency">Efici√™ncia Real</div><div class="painel-metric-value" id="painelEfficiency">0%</div></div>
            </div>

            <div class="painel-content" id="painelContent" style="display: none;">
                <div class="painel-chart" id="chartSection" style="display: none;"><h3 id="painelChartTitle">Carregando...</h3><div class="painel-chart-container"><canvas id="painelChart"></canvas></div></div>
                <div class="painel-info" id="infoSection" style="display: none;">
                    <div class="painel-info-card" id="cardResumo" style="display: none;">
                        <h4 id="cardResumoTitle">Resumo</h4>
                        <div class="painel-info-item"><span class="painel-info-label">Per√≠odo:</span><span class="painel-info-value" id="painelPeriodo">-</span></div>
                        <div class="painel-info-item"><span class="painel-info-label">Ativos:</span><span class="painel-info-value" id="painelAtivos">0</span></div>
                    </div>
                    <div class="painel-info-card" id="cardTaxa" style="display: none;">
                        <h4 id="cardTaxaTitle">Taxa</h4>
                        <div class="painel-info-item"><span class="painel-info-label">Maior:</span><span class="painel-info-value" id="painelMaiorTaxa">0%</span></div>
                        <div class="painel-info-item"><span class="painel-info-label">Menor:</span><span class="painel-info-value" id="painelMenorTaxa">0%</span></div>
                    </div>
                    <div class="painel-info-card" id="cardTiming" style="display: none;">
                        <h4 id="cardTimingTitle">Timing</h4>
                        <div class="painel-info-item"><span class="painel-info-label">Pr√≥x:</span><span class="painel-info-value" id="painelTimer">10s</span></div>
                        <div class="painel-timer">Auto</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="config" class="tab-content">
        <div class="dashboard-container"><div class="config-container">
            
            <div class="config-section">
                <h3><span class="section-icon">üñºÔ∏è</span> Logo do Painel</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <label>üì∏ Selecionar Imagem</label>
                        <input type="file" id="logoFile" accept="image/*" onchange="updateLogoFromFile()">
                    </div>
                    <div class="config-item">
                        <label>üëÅÔ∏è Preview</label>
                        <img id="logoPreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='white' width='100' height='100'/%3E%3Ctext x='50' y='55' font-size='50' fill='black' text-anchor='middle' font-weight='bold'%3Eüìä%3C/text%3E%3C/svg%3E" class="logo-preview">
                    </div>
                </div>
                <div class="config-info">Use uma imagem PNG, JPG ou GIF do seu computador. A imagem √© salva automaticamente!</div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üìù</span> T√≠tulos e Nomes Edit√°veis</h3>
                <div class="config-grid">
                    <div class="config-item"><label>T√≠tulo Dashboard</label><input type="text" id="dashboardTitle" value="Dashboard" onchange="saveConfig()"></div>
                    <div class="config-item"><label>T√≠tulo Painel</label><input type="text" id="painelTitleInput" value="Painel de Ativos" onchange="saveConfig()"></div>
                    <div class="config-item"><label>T√≠tulo Resumo</label><input type="text" id="resumoTitleInput" value="Resumo" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Card Resumo</label><input type="text" id="cardResumoTitleInput" value="Resumo" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Card Taxa</label><input type="text" id="cardTaxaTitleInput" value="Taxa" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Card Timing</label><input type="text" id="cardTimingTitleInput" value="Timing" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Abertos</label><input type="text" id="labelAbertosInput" value="Abertos" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Resolvidos</label><input type="text" id="labelResolvidosInput" value="Resolvidos" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Tempo</label><input type="text" id="labelTempoInput" value="Tempo" onchange="saveConfig()"></div>
                    <div class="config-item"><label>Label Efici√™ncia Real</label><input type="text" id="labelEfficiencyInput" value="Efici√™ncia Real" onchange="saveConfig()"></div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üéØ</span> Meta de Efici√™ncia</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <label>Meta (%)</label>
                        <input type="number" id="efficiencyTarget" value="95" min="50" max="100" onchange="saveConfig()">
                    </div>
                </div>
                <div class="config-info">
                    Insira apenas a porcentagem. üü¢ Verde quando efici√™ncia ‚â• meta | üî¥ Vermelho quando efici√™ncia < meta
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üé®</span> Cores da Faixa Superior</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <label>üéØ Cor Prim√°ria</label>
                        <input type="color" id="headerColor1" value="#667eea" onchange="updateHeaderColors(); saveConfig();">
                    </div>
                    <div class="config-item">
                        <label>‚ú® Cor Secund√°ria</label>
                        <input type="color" id="headerColor2" value="#06b6d4" onchange="updateHeaderColors(); saveConfig();">
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üåà</span> Temas Prontos</h3>
                <div class="theme-buttons" id="themeButtons"></div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üé®</span> Plano de Fundo Customizado</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <label>Tipo</label>
                        <select id="bgType" onchange="updateBgType()">
                            <option value="gradient">Gradiente</option>
                            <option value="solid">Cor S√≥lida</option>
                        </select>
                    </div>
                    <div class="config-item" id="bgColor1Item">
                        <label>Cor 1</label>
                        <input type="color" id="bgColor1" value="#0f172a" onchange="updateBackground(); saveConfig();">
                    </div>
                    <div class="config-item" id="bgColor2Item">
                        <label>Cor 2 (Gradiente)</label>
                        <input type="color" id="bgColor2" value="#1a1f3a" onchange="updateBackground(); saveConfig();">
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üëÅÔ∏è</span> Elementos do Painel</h3>
                <div class="config-grid">
                    <div class="config-checkbox"><input type="checkbox" id="showAbertos" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showAbertos">üî¥ Abertos</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showResolvidos" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showResolvidos">‚úÖ Resolvidos</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showMeta" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showMeta">üìä Meta</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showTempo" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showTempo">‚è±Ô∏è Tempo</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showEfficiency" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showEfficiency">üìà Efici√™ncia Real</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showChart" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showChart">üìâ Gr√°fico</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showResumo" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showResumo">üî¥ Resumo</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showTaxaMedia" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showTaxaMedia">üìä Taxa M√©dia</label></div>
                    <div class="config-checkbox"><input type="checkbox" id="showTiming" checked onchange="updatePainelVisibility(); saveConfig();"><label for="showTiming">‚è±Ô∏è Timing</label></div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üé®</span> Cores Gerais</h3>
                <div class="config-grid">
                    <div class="config-item"><label>üî∑ Prim√°ria</label><input type="color" id="colorPrimary" value="#667eea" onchange="saveConfig()"></div>
                    <div class="config-item"><label>üî∂ Secund√°ria</label><input type="color" id="colorSecondary" value="#06b6d4" onchange="saveConfig()"></div>
                    <div class="config-item"><label>üü† Laranja</label><input type="color" id="colorOrange" value="#FF8C42" onchange="saveConfig()"></div>
                    <div class="config-item"><label>üü¶ Teal</label><input type="color" id="colorTeal" value="#4ECDC4" onchange="saveConfig()"></div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üìè</span> Tamanhos</h3>
                <div class="config-grid">
                    <div class="config-item"><label>üìù T√≠tulo Painel</label><input type="number" id="headerSize" value="28" min="14" max="48" onchange="applySizes(); saveConfig();"></div>
                    <div class="config-item"><label>üïê Timestamp</label><input type="number" id="timestampSize" value="16" min="10" max="28" onchange="applySizes(); saveConfig();"></div>
                    <div class="config-item"><label>üè∑Ô∏è Label M√©trica</label><input type="number" id="metricLabelSize" value="11" min="8" max="16" onchange="applySizes(); saveConfig();"></div>
                    <div class="config-item"><label>üî¢ Valor M√©trica</label><input type="number" id="metricValueSize" value="28" min="16" max="48" onchange="applySizes(); saveConfig();"></div>
                    <div class="config-item"><label>üìä T√≠tulo Gr√°fico</label><input type="number" id="chartTitleSize" value="20" min="14" max="32" onchange="applySizes(); saveConfig();"></div>
                    <div class="config-item"><label>üéØ Gap M√©tricas</label><input type="number" id="metricsGap" value="12" min="4" max="32" onchange="applySizes(); saveConfig();"></div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">‚è±Ô∏è</span> Timing e Textos</h3>
                <div class="config-grid">
                    <div class="config-item"><label>‚è∞ Rota√ß√£o (s)</label><input type="number" id="rotationTime" value="10" min="5" max="60" onchange="saveConfig()"></div>
                    <div class="config-item"><label>üìà Tipo Gr√°fico</label><select id="chartType" onchange="saveConfig()"><option value="bar">Barras</option><option value="line">Linha</option><option value="doughnut">Rosca</option><option value="pie">Pizza</option></select></div>
                </div>
            </div>

            <div class="config-section">
                <h3><span class="section-icon">üíæ</span> A√ß√µes</h3>
                <div class="config-buttons">
                    <button class="config-button primary" onclick="saveConfig()">üíæ Salvar Tudo</button>
                    <button class="config-button secondary" onclick="resetConfig()">üîÑ Restaurar Padr√£o</button>
                    <button class="config-button primary" onclick="testPainel()">üëÅÔ∏è Testar Painel</button>
                </div>
            </div>

        </div></div>
    </div>

    <script>
    const THEMES = [
        { name: 'Azul Profissional', colors: {bgColor1: '#0f172a', bgColor2: '#1a1f3a', primary: '#667eea', secondary: '#06b6d4'}, preview: 'linear-gradient(135deg, #0f172a 0%, #1a1f3a 100%)' },
        { name: 'Roxo Elegante', colors: {bgColor1: '#1a0933', bgColor2: '#3d1a66', primary: '#9d4edd', secondary: '#c77dff'}, preview: 'linear-gradient(135deg, #1a0933 0%, #3d1a66 100%)' },
        { name: 'Verde Natureza', colors: {bgColor1: '#0d3b0d', bgColor2: '#1a5e1a', primary: '#10b981', secondary: '#34d399'}, preview: 'linear-gradient(135deg, #0d3b0d 0%, #1a5e1a 100%)' },
        { name: 'Laranja Energia', colors: {bgColor1: '#4d2500', bgColor2: '#8b4513', primary: '#FF8C42', secondary: '#ff6b35'}, preview: 'linear-gradient(135deg, #4d2500 0%, #8b4513 100%)' },
        { name: 'Vermelho Vibrante', colors: {bgColor1: '#330000', bgColor2: '#660000', primary: '#ef4444', secondary: '#f87171'}, preview: 'linear-gradient(135deg, #330000 0%, #660000 100%)' },
        { name: 'Teal Moderno', colors: {bgColor1: '#0a3d3d', bgColor2: '#1a5f5f', primary: '#4ECDC4', secondary: '#45b7b8'}, preview: 'linear-gradient(135deg, #0a3d3d 0%, #1a5f5f 100%)' },
        { name: 'Cinza Sofisticado', colors: {bgColor1: '#1a1a1a', bgColor2: '#2d2d2d', primary: '#808080', secondary: '#a0a0a0'}, preview: 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)' },
        { name: 'Rosa Suave', colors: {bgColor1: '#3d1a2a', bgColor2: '#661a4d', primary: '#ec4899', secondary: '#f472b6'}, preview: 'linear-gradient(135deg, #3d1a2a 0%, #661a4d 100%)' },
        { name: 'Amarelo Dourado', colors: {bgColor1: '#4d3300', bgColor2: '#8b6600', primary: '#fbbf24', secondary: '#fcd34d'}, preview: 'linear-gradient(135deg, #4d3300 0%, #8b6600 100%)' },
        { name: 'Azul Noite', colors: {bgColor1: '#0a1a2a', bgColor2: '#1a3a4a', primary: '#3b82f6', secondary: '#60a5fa'}, preview: 'linear-gradient(135deg, #0a1a2a 0%, #1a3a4a 100%)' }
    ];

    let app = {
        relatorio: null, consolidado: null, grupos: new Set(),
        charts: {}, painelChartIndex: 0, painelTimer: null, painelCountdown: 10, chartType: 'bar', currentEfficiency: 0, lastUpdateTime: null,
        config: {
            colorPrimary: '#667eea', colorSecondary: '#06b6d4', colorOrange: '#FF8C42', colorTeal: '#4ECDC4',
            rotationTime: 10000, painelTitle: 'Painel de Ativos', logoUrl: '',
            headerSize: 28, timestampSize: 16, metricLabelSize: 11, metricValueSize: 28, chartTitleSize: 20,
            metricsGap: 12, headerPadding: '15px 25px', metricsPadding: '15px 25px', contentPadding: '20px 25px',
            infoWidth: 260, chartType: 'bar', efficiencyTarget: 95,
            showAbertos: true, showResolvidos: true, showMeta: true, showTempo: true, showEfficiency: true,
            showChart: true, showResumo: true, showTaxaMedia: true, showTiming: true,
            bgType: 'gradient', bgColor1: '#0f172a', bgColor2: '#1a1f3a',
            headerColor1: '#667eea', headerColor2: '#06b6d4',
            dashboardTitle: 'Dashboard', resumoTitle: 'Resumo', cardResumoTitle: 'Resumo', cardTaxaTitle: 'Taxa', cardTimingTitle: 'Timing',
            labelAbertos: 'Abertos', labelResolvidos: 'Resolvidos', labelTempo: 'Tempo', labelEfficiency: 'Efici√™ncia Real'
        }
    };

    document.addEventListener('DOMContentLoaded', function () {
        loadConfig();
        document.getElementById('fileRelatorio').addEventListener('change', handleFileRelatorio);
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('painel').classList.contains('active')) exitPainel();
        });
        setInterval(checkForNewData, 2000);
    });

    function checkForNewData() {
        const storedTime = localStorage.getItem('dashboardDataTime');
        if (app.consolidado && storedTime && storedTime !== app.lastUpdateTime) {
            loadStoredData();
        }
    }

    function loadConfig() {
        const saved = localStorage.getItem('dashboardConfig');
        if (saved) app.config = Object.assign(app.config, JSON.parse(saved));
        applyConfig();
    }

    function applyConfig() {
        document.getElementById('colorPrimary').value = app.config.colorPrimary;
        document.getElementById('colorSecondary').value = app.config.colorSecondary;
        document.getElementById('colorOrange').value = app.config.colorOrange;
        document.getElementById('colorTeal').value = app.config.colorTeal;
        document.getElementById('rotationTime').value = app.config.rotationTime / 1000;
        document.getElementById('painelTitleInput').value = app.config.painelTitle;
        document.getElementById('dashboardTitle').value = app.config.dashboardTitle;
        document.getElementById('resumoTitleInput').value = app.config.resumoTitle;
        document.getElementById('cardResumoTitleInput').value = app.config.cardResumoTitle;
        document.getElementById('cardTaxaTitleInput').value = app.config.cardTaxaTitle;
        document.getElementById('cardTimingTitleInput').value = app.config.cardTimingTitle;
        document.getElementById('labelAbertosInput').value = app.config.labelAbertos;
        document.getElementById('labelResolvidosInput').value = app.config.labelResolvidos;
        document.getElementById('labelTempoInput').value = app.config.labelTempo;
        document.getElementById('labelEfficiencyInput').value = app.config.labelEfficiency;
        document.getElementById('chartType').value = app.config.chartType;
        document.getElementById('efficiencyTarget').value = app.config.efficiencyTarget;
        document.getElementById('headerSize').value = app.config.headerSize;
        document.getElementById('timestampSize').value = app.config.timestampSize;
        document.getElementById('metricLabelSize').value = app.config.metricLabelSize;
        document.getElementById('metricValueSize').value = app.config.metricValueSize;
        document.getElementById('chartTitleSize').value = app.config.chartTitleSize;
        document.getElementById('metricsGap').value = app.config.metricsGap;
        document.getElementById('bgType').value = app.config.bgType;
        document.getElementById('bgColor1').value = app.config.bgColor1;
        document.getElementById('bgColor2').value = app.config.bgColor2;
        document.getElementById('headerColor1').value = app.config.headerColor1;
        document.getElementById('headerColor2').value = app.config.headerColor2;
        document.getElementById('showAbertos').checked = app.config.showAbertos;
        document.getElementById('showResolvidos').checked = app.config.showResolvidos;
        document.getElementById('showMeta').checked = app.config.showMeta;
        document.getElementById('showTempo').checked = app.config.showTempo;
        document.getElementById('showEfficiency').checked = app.config.showEfficiency;
        document.getElementById('showChart').checked = app.config.showChart;
        document.getElementById('showResumo').checked = app.config.showResumo;
        document.getElementById('showTaxaMedia').checked = app.config.showTaxaMedia;
        document.getElementById('showTiming').checked = app.config.showTiming;

        document.documentElement.style.setProperty('--primary', app.config.colorPrimary);
        document.documentElement.style.setProperty('--secondary', app.config.colorSecondary);
        document.documentElement.style.setProperty('--orange', app.config.colorOrange);
        document.documentElement.style.setProperty('--teal', app.config.colorTeal);

        applySizes();
        updateBackground();
        updateHeaderColors();
        createThemeButtons();
        if (app.config.logoUrl) {
            document.getElementById('painelLogoImg').src = app.config.logoUrl;
            document.getElementById('logoPreview').src = app.config.logoUrl;
        }
        document.getElementById('painelTitle').textContent = app.config.painelTitle;
        document.getElementById('resumoTitle').textContent = app.config.resumoTitle;
        document.getElementById('metaLabel').textContent = 'Meta: ' + app.config.efficiencyTarget + '%';
        updatePainelLabels();
        updatePainelVisibility();
        setInterval(() => {
            const now = new Date();
            document.getElementById('painelTimestamp').textContent = now.toLocaleString('pt-BR');
        }, 1000);
    }

    function updatePainelLabels() {
        document.getElementById('labelAbertos').textContent = app.config.labelAbertos;
        document.getElementById('labelResolvidos').textContent = app.config.labelResolvidos;
        document.getElementById('labelTempo').textContent = app.config.labelTempo;
        document.getElementById('labelEfficiency').textContent = app.config.labelEfficiency;
        document.getElementById('cardResumoTitle').textContent = app.config.cardResumoTitle;
        document.getElementById('cardTaxaTitle').textContent = app.config.cardTaxaTitle;
        document.getElementById('cardTimingTitle').textContent = app.config.cardTimingTitle;
    }

    function createThemeButtons() {
        const container = document.getElementById('themeButtons');
        container.innerHTML = '';
        THEMES.forEach((theme) => {
            const btn = document.createElement('button');
            btn.className = 'theme-btn';
            btn.innerHTML = `<div class="theme-preview" style="background: ${theme.preview};"></div>${theme.name}`;
            btn.onclick = () => applyTheme(theme);
            container.appendChild(btn);
        });
    }

    function applyTheme(theme) {
        app.config.bgColor1 = theme.colors.bgColor1;
        app.config.bgColor2 = theme.colors.bgColor2;
        app.config.colorPrimary = theme.colors.primary;
        app.config.colorSecondary = theme.colors.secondary;
        app.config.headerColor1 = theme.colors.primary;
        app.config.headerColor2 = theme.colors.secondary;
        document.getElementById('bgColor1').value = theme.colors.bgColor1;
        document.getElementById('bgColor2').value = theme.colors.bgColor2;
        document.getElementById('colorPrimary').value = theme.colors.primary;
        document.getElementById('colorSecondary').value = theme.colors.secondary;
        document.getElementById('headerColor1').value = theme.colors.primary;
        document.getElementById('headerColor2').value = theme.colors.secondary;
        saveConfig();
    }

    function updateHeaderColors() {
        app.config.headerColor1 = document.getElementById('headerColor1').value;
        app.config.headerColor2 = document.getElementById('headerColor2').value;
        document.documentElement.style.setProperty('--header-color-1', app.config.headerColor1);
        document.documentElement.style.setProperty('--header-color-2', app.config.headerColor2);
    }

    function updateBgType() {
        const bgType = document.getElementById('bgType').value;
        app.config.bgType = bgType;
        document.getElementById('bgColor2Item').style.display = bgType === 'gradient' ? 'flex' : 'none';
        updateBackground();
        saveConfig();
    }

    function updateBackground() {
        const bgType = app.config.bgType;
        const color1 = document.getElementById('bgColor1').value;
        const color2 = document.getElementById('bgColor2').value;
        app.config.bgColor1 = color1;
        app.config.bgColor2 = color2;
        if (bgType === 'gradient') {
            document.documentElement.style.setProperty('--bg-gradient', `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`);
        } else {
            document.documentElement.style.setProperty('--bg-gradient', color1);
        }
    }

    function updateLogoFromFile() {
        const file = document.getElementById('logoFile').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                app.config.logoUrl = e.target.result;
                document.getElementById('painelLogoImg').src = app.config.logoUrl;
                document.getElementById('logoPreview').src = app.config.logoUrl;
                saveConfig();
            };
            reader.readAsDataURL(file);
        }
    }

    function applySizes() {
        app.config.headerSize = parseInt(document.getElementById('headerSize').value);
        app.config.timestampSize = parseInt(document.getElementById('timestampSize').value);
        app.config.metricLabelSize = parseInt(document.getElementById('metricLabelSize').value);
        app.config.metricValueSize = parseInt(document.getElementById('metricValueSize').value);
        app.config.chartTitleSize = parseInt(document.getElementById('chartTitleSize').value);
        app.config.metricsGap = parseInt(document.getElementById('metricsGap').value);
        document.documentElement.style.setProperty('--header-size', app.config.headerSize + 'px');
        document.documentElement.style.setProperty('--timestamp-size', app.config.timestampSize + 'px');
        document.documentElement.style.setProperty('--metric-label-size', app.config.metricLabelSize + 'px');
        document.documentElement.style.setProperty('--metric-value-size', app.config.metricValueSize + 'px');
        document.documentElement.style.setProperty('--chart-title-size', app.config.chartTitleSize + 'px');
        document.documentElement.style.setProperty('--metrics-gap', app.config.metricsGap + 'px');
    }

    function saveConfig() {
        app.config.colorPrimary = document.getElementById('colorPrimary').value;
        app.config.colorSecondary = document.getElementById('colorSecondary').value;
        app.config.colorOrange = document.getElementById('colorOrange').value;
        app.config.colorTeal = document.getElementById('colorTeal').value;
        app.config.rotationTime = parseInt(document.getElementById('rotationTime').value) * 1000;
        app.config.painelTitle = document.getElementById('painelTitleInput').value;
        app.config.dashboardTitle = document.getElementById('dashboardTitle').value;
        app.config.resumoTitle = document.getElementById('resumoTitleInput').value;
        app.config.cardResumoTitle = document.getElementById('cardResumoTitleInput').value;
        app.config.cardTaxaTitle = document.getElementById('cardTaxaTitleInput').value;
        app.config.cardTimingTitle = document.getElementById('cardTimingTitleInput').value;
        app.config.labelAbertos = document.getElementById('labelAbertosInput').value;
        app.config.labelResolvidos = document.getElementById('labelResolvidosInput').value;
        app.config.labelTempo = document.getElementById('labelTempoInput').value;
        app.config.labelEfficiency = document.getElementById('labelEfficiencyInput').value;
        app.config.chartType = document.getElementById('chartType').value;
        app.config.efficiencyTarget = parseInt(document.getElementById('efficiencyTarget').value);
        app.config.showAbertos = document.getElementById('showAbertos').checked;
        app.config.showResolvidos = document.getElementById('showResolvidos').checked;
        app.config.showMeta = document.getElementById('showMeta').checked;
        app.config.showTempo = document.getElementById('showTempo').checked;
        app.config.showEfficiency = document.getElementById('showEfficiency').checked;
        app.config.showChart = document.getElementById('showChart').checked;
        app.config.showResumo = document.getElementById('showResumo').checked;
        app.config.showTaxaMedia = document.getElementById('showTaxaMedia').checked;
        app.config.showTiming = document.getElementById('showTiming').checked;
        app.chartType = app.config.chartType;
        localStorage.setItem('dashboardConfig', JSON.stringify(app.config));
        applyConfig();
        showSuccess('‚úÖ Configura√ß√µes salvas!');
    }

    function updatePainelVisibility() {
        document.getElementById('metricAbertos').style.display = app.config.showAbertos ? 'block' : 'none';
        document.getElementById('metricResolvidos').style.display = app.config.showResolvidos ? 'block' : 'none';
        document.getElementById('metricMeta').style.display = app.config.showMeta ? 'block' : 'none';
        document.getElementById('metricTempo').style.display = app.config.showTempo ? 'block' : 'none';
        document.getElementById('metricEfficiency').style.display = app.config.showEfficiency ? 'block' : 'none';
        document.getElementById('chartSection').style.display = app.config.showChart ? 'flex' : 'none';
        document.getElementById('cardResumo').style.display = app.config.showResumo ? 'block' : 'none';
        document.getElementById('cardTaxa').style.display = app.config.showTaxaMedia ? 'block' : 'none';
        document.getElementById('cardTiming').style.display = app.config.showTiming ? 'block' : 'none';

        const hasVisibleInfo = app.config.showResumo || app.config.showTaxaMedia || app.config.showTiming;
        document.getElementById('infoSection').style.display = hasVisibleInfo ? 'flex' : 'none';

        const hasAnyMetric = app.config.showAbertos || app.config.showResolvidos || app.config.showMeta || app.config.showTempo || app.config.showEfficiency;
        document.getElementById('painelMetricsContainer').style.display = hasAnyMetric ? 'grid' : 'none';
    }

    function exitPainel() { switchTab('dashboard'); }
    function resetConfig() {
        if (confirm('Restaurar padr√£o?')) {
            localStorage.removeItem('dashboardConfig');
            location.reload();
        }
    }
    function testPainel() { switchTab('painel'); }

    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.querySelector(`[onclick="switchTab('${tab}')\"]`).classList.add('active');
        const tabsContainer = document.querySelector('.tabs-container');
        if (tab === 'painel') {
            tabsContainer.classList.add('hidden');
            startPanelRotation();
        } else {
            tabsContainer.classList.remove('hidden');
            stopPanelRotation();
        }
    }

    function handleFileRelatorio(e) {
        const file = e.target.files[0];
        if (!file) return;
        document.getElementById('fileNameRelatorio').textContent = 'Carregando...';
        readFile(file, function(data) {
            const name = file.name.length > 25 ? file.name.substring(0, 22) + '...' : file.name;
            document.getElementById('fileNameRelatorio').textContent = '‚úì ' + name;
            document.getElementById('fileNameRelatorio').title = file.name;
            const now = new Date();
            document.getElementById('timeRelatorio').textContent = 'Carregado em ' + now.toLocaleTimeString('pt-BR');
            app.relatorio = data;
            processData();
        });
    }

    function readFile(file, callback) {
        if (typeof XLSX === 'undefined') {
            showError('‚ùå XLSX n√£o carregou');
            return;
        }
        const reader = new FileReader();
        reader.onerror = () => showError('Erro ao ler arquivo');
        reader.onload = event => {
            try {
                const workbook = XLSX.read(event.target.result, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                callback(jsonData);
            } catch (error) {
                showError('Erro ao processar: ' + error.message);
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function parseDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.toString().split(' ')[0].split('/');
        if (parts.length === 3) return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));
        return null;
    }

    function formatDate(date) {
        if (!date) return null;
        const y = date.getFullYear(), m = String(date.getMonth() + 1).padStart(2, '0'), d = String(date.getDate()).padStart(2, '0');
        return y + '-' + m + '-' + d;
    }

    function formatDateDisplay(dateStr) {
        if (!dateStr) return '';
        const [y, m, d] = dateStr.split('-');
        return new Date(y, m - 1, d).toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'});
    }

    function formatDateMonth(dateStr) {
        if (!dateStr) return '';
        const [y, m] = dateStr.split('-');
        return new Date(y, m - 1).toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'});
    }

    function calculateSLA(dataAberta, dataFechada) {
        if (!dataAberta || !dataFechada) return 0;
        const start = parseDate(dataAberta);
        const end = parseDate(dataFechada);
        if (!start || !end) return 0;
        const diffMs = end - start;
        const diffHours = diffMs / (1000 * 60 * 60);
        return Math.max(0, diffHours);
    }

    function processData() {
        try {
            app.consolidado = {};
            app.grupos.clear();
            
            app.relatorio.forEach(row => {
                if (!row['N√öMERO OS']) return;
                const os = String(Math.round(row['N√öMERO OS'])).padStart(13, '0');
                const grupo = (row['GRUPO DE TRABALHO'] || 'GERAL').trim();
                app.grupos.add(grupo);
                
                const status = (row['STATUS'] || '').toUpperCase();
                const dataCriacao = row['CRIADO EM'] || '';
                const dataEncerramento = row['ENCERRADO EM'] || '';
                
                let sla = 0;
                if (dataCriacao && dataEncerramento) {
                    sla = calculateSLA(dataCriacao, dataEncerramento);
                }
                
                app.consolidado[os] = {
                    os, grupo, dataCriacao, status,
                    dataEncerramento: dataEncerramento,
                    sla: sla
                };
            });
            
            app.lastUpdateTime = new Date().toISOString();
            localStorage.setItem('dashboardDataTime', app.lastUpdateTime);
            localStorage.setItem('dashboardConsolidado', JSON.stringify(app.consolidado));
            
            populateFilters();
            showSuccess('‚úÖ Arquivo processado!');
        } catch (error) {
            console.error(error);
            showError('Erro ao processar: ' + error.message);
        }
    }

    function loadStoredData() {
        const stored = localStorage.getItem('dashboardConsolidado');
        if (stored) {
            app.consolidado = JSON.parse(stored);
            app.lastUpdateTime = localStorage.getItem('dashboardDataTime');
            app.grupos.clear();
            Object.values(app.consolidado).forEach(d => app.grupos.add(d.grupo || 'GERAL'));
            populateFilters();
        }
    }

    function populateFilters() {
        const meses = new Set();
        Object.values(app.consolidado).forEach(d => {
            if (d.dataCriacao) { const date = parseDate(d.dataCriacao); if (date) meses.add(formatDate(date).slice(0, 7)); }
            if (d.dataEncerramento) { const date = parseDate(d.dataEncerramento); if (date) meses.add(formatDate(date).slice(0, 7)); }
        });
        const mesSelect = document.getElementById('mesFilter');
        mesSelect.innerHTML = '<option value="">Selecionar...</option>';
        Array.from(meses).sort().reverse().forEach(mes => {
            const [y, m] = mes.split('-');
            const name = new Date(y, m - 1).toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'});
            const opt = document.createElement('option');
            opt.value = mes;
            opt.textContent = name.charAt(0).toUpperCase() + name.slice(1);
            mesSelect.appendChild(opt);
        });
        const ativoSelect = document.getElementById('ativoFilter');
        ativoSelect.innerHTML = '<option value="">Todos</option>';
        Array.from(app.grupos).sort().forEach(grupo => {
            const opt = document.createElement('option');
            opt.value = grupo;
            opt.textContent = grupo;
            ativoSelect.appendChild(opt);
        });
        const totalAbertas = Object.values(app.consolidado).filter(d => d.status && d.status !== 'CANCELADA').length;
        const totalEncerradas = Object.values(app.consolidado).filter(d => d.dataEncerramento).length;
        const tempos = Object.values(app.consolidado).filter(d => d.sla > 0).map(d => d.sla);
        const tempoMedio = tempos.length ? (tempos.reduce((a, b) => a + b) / tempos.length).toFixed(1) : 0;
        const taxaResolucao = totalAbertas ? ((totalEncerradas / totalAbertas) * 100).toFixed(1) : 0;
        document.getElementById('totalAberturas').textContent = totalAbertas;
        document.getElementById('totalEncerrados').textContent = totalEncerradas;
        document.getElementById('taxaResolucao').textContent = taxaResolucao + '%';
        document.getElementById('tempoMedio').textContent = tempoMedio + 'h';
        document.getElementById('header').style.display = 'block';
        document.getElementById('filterSection').classList.add('active');
        document.getElementById('metricsGrid').classList.add('active');
        document.getElementById('chartsGrid').classList.add('active');
        document.getElementById('tableCard').classList.add('active');
        document.getElementById('noDataMessage').style.display = 'none';
        document.getElementById('painelMetricsContainer').style.display = 'grid';
        document.getElementById('painelContent').style.display = 'flex';
        
        const lastUpdate = app.lastUpdateTime ? new Date(app.lastUpdateTime).toLocaleString('pt-BR') : 'Nunca';
        document.getElementById('lastUpdateText').textContent = '√öltima atualiza√ß√£o: ' + lastUpdate;
        
        const mesesArray = Array.from(meses).sort().reverse();
        if (mesesArray.length > 0) {
            document.getElementById('mesFilter').value = mesesArray[0];
            onMesChange();
        }
    }

    function onMesChange() {
        const mes = document.getElementById('mesFilter').value;
        const diaSelect = document.getElementById('diaFilter');
        if (!mes) { diaSelect.innerHTML = '<option value="">Todos</option>'; return; }
        const dias = new Set();
        Object.values(app.consolidado).forEach(d => {
            const dates = [];
            if (d.dataCriacao) { const date = parseDate(d.dataCriacao); if (date) dates.push(date); }
            if (d.dataEncerramento) { const date = parseDate(d.dataEncerramento); if (date) dates.push(date); }
            dates.forEach(date => { if (formatDate(date).startsWith(mes)) dias.add(formatDate(date)); });
        });
        diaSelect.innerHTML = '<option value="">Todos</option>';
        Array.from(dias).sort().reverse().forEach(dia => {
            const opt = document.createElement('option');
            opt.value = dia;
            opt.textContent = formatDateDisplay(dia);
            diaSelect.appendChild(opt);
        });
        updateAllCharts();
    }

    function getLatestDay(mes) {
        let latest = null;
        Object.values(app.consolidado).forEach(d => {
            const dates = [];
            if (d.dataCriacao) { const date = parseDate(d.dataCriacao); if (date && formatDate(date).startsWith(mes)) dates.push(date); }
            if (d.dataEncerramento) { const date = parseDate(d.dataEncerramento); if (date && formatDate(date).startsWith(mes)) dates.push(date); }
            dates.forEach(date => { if (!latest || date > latest) latest = date; });
        });
        return latest ? formatDate(latest) : null;
    }

    function getDayData(dia, ativo) {
        const data = {};
        Array.from(app.grupos).forEach(g => { data[g] = {abertos: 0, encerrados: 0}; });
        Object.values(app.consolidado).forEach(d => {
            if (ativo && d.grupo !== ativo) return;
            const g = d.grupo || 'GERAL';
            const diaAberta = d.dataCriacao ? formatDate(parseDate(d.dataCriacao)) : null;
            const diaEncerrada = d.dataEncerramento ? formatDate(parseDate(d.dataEncerramento)) : null;
            if (diaAberta === dia && d.status !== 'CANCELADA') data[g].abertos++;
            if (diaEncerrada === dia) data[g].encerrados++;
        });
        return data;
    }

    function getMonthData(mes, ativo) {
        const data = {};
        Array.from(app.grupos).forEach(g => { data[g] = {abertos: 0, encerrados: 0, tempos: []}; });
        Object.values(app.consolidado).forEach(d => {
            if (ativo && d.grupo !== ativo) return;
            const g = d.grupo || 'GERAL';
            const mesAberta = d.dataCriacao ? formatDate(parseDate(d.dataCriacao)).slice(0, 7) : null;
            const mesEncerrada = d.dataEncerramento ? formatDate(parseDate(d.dataEncerramento)).slice(0, 7) : null;
            if (mesAberta === mes && d.status !== 'CANCELADA') data[g].abertos++;
            if (mesEncerrada === mes && d.dataEncerramento) { data[g].encerrados++; if (d.sla) data[g].tempos.push(d.sla); }
        });
        return data;
    }

    function updateAllCharts() {
        const mes = document.getElementById('mesFilter').value;
        const dia = document.getElementById('diaFilter').value;
        const ativo = document.getElementById('ativoFilter').value;
        if (!mes) return;
        const diaRecente = getLatestDay(mes);
        const diaFilter = dia || diaRecente;
        const dataDia = diaFilter ? getDayData(diaFilter, ativo) : {};
        const dataMes = getMonthData(mes, ativo);
        updateMetrics(dataMes);
        renderChart1(dataDia, diaFilter);
        renderChart2(dataMes, mes);
        renderChart3(dataMes);
        renderChart4(dataMes);
        renderTable(dataMes);
        updatePanelMetrics(dataMes, diaFilter, mes);
    }

    function updateMetrics(data) {
        const abertos = Object.values(data).reduce((sum, d) => sum + d.abertos, 0);
        const resolvidos = Object.values(data).reduce((sum, d) => sum + d.encerrados, 0);
        const tempos = [];
        Object.values(data).forEach(d => tempos.push(...d.tempos));
        const sla = tempos.length ? (tempos.reduce((a, b) => a + b) / tempos.length).toFixed(1) : 0;
        document.getElementById('abertosMetrica').textContent = abertos;
        document.getElementById('resolvidosMetrica').textContent = resolvidos;
        document.getElementById('slaMedia').textContent = sla + 'h';
        document.getElementById('produtividade').textContent = abertos ? ((resolvidos / abertos) * 100).toFixed(1) + '%' : '0%';
    }

    function updatePanelMetrics(data, dia, mes) {
        const abertos = Object.values(data).reduce((sum, d) => sum + d.abertos, 0);
        const resolvidos = Object.values(data).reduce((sum, d) => sum + d.encerrados, 0);
        const taxa = abertos ? ((resolvidos / abertos) * 100).toFixed(1) : 0;
        const tempos = [];
        Object.values(data).forEach(d => tempos.push(...d.tempos));
        const tempo = tempos.length ? (tempos.reduce((a, b) => a + b) / tempos.length).toFixed(1) : 0;
        app.currentEfficiency = parseFloat(taxa);
        document.getElementById('painelAbertos').textContent = abertos;
        document.getElementById('painelResolvidos').textContent = resolvidos;
        document.getElementById('painelMeta').textContent = app.config.efficiencyTarget + '%';
        document.getElementById('painelTempo').textContent = tempo + 'h';
        document.getElementById('painelEfficiency').textContent = taxa + '%';
        document.getElementById('painelAtivos').textContent = Object.keys(data).length;
        const metricEfficiency = document.getElementById('metricEfficiency');
        if (parseFloat(taxa) >= app.config.efficiencyTarget) {
            metricEfficiency.classList.remove('danger');
        } else {
            metricEfficiency.classList.add('danger');
        }
        const taxas = Object.values(data).map(d => d.abertos ? (d.encerrados / d.abertos * 100).toFixed(1) : 0);
        if (taxas.length) {
            document.getElementById('painelMaiorTaxa').textContent = Math.max(...taxas.map(Number)).toFixed(1) + '%';
            document.getElementById('painelMenorTaxa').textContent = Math.min(...taxas.map(Number)).toFixed(1) + '%';
        }
        if (mes) {
            let periodoText = '';
            if (dia) { periodoText = formatDateDisplay(dia) + ' de ' + formatDateMonth(mes).split(' ')[0]; }
            else { periodoText = formatDateMonth(mes); }
            document.getElementById('painelPeriodo').textContent = periodoText;
        }
    }

    const chartLabelsPlugin = {
        afterDatasetsDraw(chart) {
            const ctx = chart.ctx;
            chart.data.datasets.forEach((dataset, datasetIndex) => {
                const meta = chart.getDatasetMeta(datasetIndex);
                meta.data.forEach((bar, index) => {
                    const value = dataset.data[index];
                    if (value == null || value === 0) return;
                    ctx.save();
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px Segoe UI';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    ctx.fillText(value, bar.x, bar.y - 4);
                    ctx.restore();
                });
            });
        }
    };

    function renderChart1(data, dia) {
        const labelsBase = Object.keys(data).sort();
        const abertosBase = labelsBase.map(l => data[l].abertos);
        const encerradosBase = labelsBase.map(l => data[l].encerrados);
        const totalAbertos = abertosBase.reduce((a, b) => a + b, 0);
        const totalEncerrados = encerradosBase.reduce((a, b) => a + b, 0);
        const labels = labelsBase.concat('TOTAL');
        const abertos = abertosBase.concat(totalAbertos);
        const encerrados = encerradosBase.concat(totalEncerrados);
        document.getElementById('chart1Title').textContent = 'Abertos vs Encerrados - Dia' + (dia ? ' (' + formatDateDisplay(dia) + ')' : '');
        destroyChart('chart1');
        const ctx = document.getElementById('chart1').getContext('2d');
        app.charts.chart1 = new Chart(ctx, {type: app.chartType, data: {labels, datasets: [{label: 'Abertos', data: abertos, backgroundColor: app.config.colorOrange, borderRadius: 8, borderSkipped: false}, {label: 'Encerrados', data: encerrados, backgroundColor: app.config.colorTeal, borderRadius: 8, borderSkipped: false}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {labels: {color: '#cbd5e1', font: {weight: 'bold'}}}}, scales: {y: {beginAtZero: true, ticks: {color: '#cbd5e1'}, grid: {color: 'rgba(71, 85, 105, 0.1)'}}, x: {ticks: {color: '#cbd5e1'}, grid: {display: false}}}, plugins: [chartLabelsPlugin]}});
    }

    function renderChart2(data, mes) {
        const labels = Object.keys(data).sort();
        const abertos = labels.map(l => data[l].abertos);
        const encerrados = labels.map(l => data[l].encerrados);
        const totalAbertos = abertos.reduce((a, b) => a + b, 0);
        const totalEncerrados = encerrados.reduce((a, b) => a + b, 0);
        document.getElementById('chart2Title').textContent = 'Consolidado - M√™s' + (mes ? ' (' + formatDateMonth(mes).charAt(0).toUpperCase() + formatDateMonth(mes).slice(1) + ')' : '');
        destroyChart('chart2');
        const ctx = document.getElementById('chart2').getContext('2d');
        const labelsComTotal = labels.concat('TOTAL');
        const abertosComTotal = abertos.concat(totalAbertos);
        const encerradosComTotal = encerrados.concat(totalEncerrados);
        app.charts.chart2 = new Chart(ctx, {type: app.chartType, data: {labels: labelsComTotal, datasets: [{label: 'Abertos', data: abertosComTotal, backgroundColor: app.config.colorOrange, borderRadius: 8, borderSkipped: false}, {label: 'Encerrados', data: encerradosComTotal, backgroundColor: app.config.colorTeal, borderRadius: 8, borderSkipped: false}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {labels: {color: '#cbd5e1', font: {weight: 'bold'}}}}, scales: {y: {beginAtZero: true, ticks: {color: '#cbd5e1'}, grid: {color: 'rgba(71, 85, 105, 0.1)'}}, x: {ticks: {color: '#cbd5e1'}, grid: {display: false}}}, plugins: [chartLabelsPlugin]}});
    }

    function renderChart3(data) {
        const labels = Object.keys(data).sort();
        const tempos = labels.map(l => {const t = data[l].tempos; return t.length ? (t.reduce((a, b) => a + b) / t.length).toFixed(1) : 0;});
        destroyChart('chart3');
        const ctx = document.getElementById('chart3').getContext('2d');
        app.charts.chart3 = new Chart(ctx, {type: 'line', data: {labels, datasets: [{label: 'Tempo M√©dio (h)', data: tempos, borderColor: app.config.colorPrimary, backgroundColor: 'rgba(102, 126, 234, 0.1)', tension: 0.4, fill: true, borderWidth: 3, pointRadius: 6, pointBackgroundColor: app.config.colorPrimary}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {labels: {color: '#cbd5e1'}}}, scales: {y: {beginAtZero: true, ticks: {color: '#cbd5e1'}, grid: {color: 'rgba(71, 85, 105, 0.1)'}}, x: {ticks: {color: '#cbd5e1'}, grid: {display: false}}}}});
    }

    function renderChart4(data) {
        const labels = Object.keys(data).sort();
        const taxas = labels.map(l => {const d = data[l]; return d.abertos ? (d.encerrados / d.abertos * 100).toFixed(1) : 0;});
        destroyChart('chart4');
        const ctx = document.getElementById('chart4').getContext('2d');
        app.charts.chart4 = new Chart(ctx, {type: 'doughnut', data: {labels, datasets: [{data: taxas, backgroundColor: [app.config.colorPrimary, app.config.colorSecondary, '#10b981', '#06b6d4', app.config.colorOrange, app.config.colorTeal]}]}, options: {responsive: true, maintainAspectRatio: false, plugins: {legend: {labels: {color: '#cbd5e1'}}}}});
    }

    function renderTable(data) {
        const tbody = document.getElementById('summaryTable');
        tbody.innerHTML = '';
        Object.keys(data).sort().forEach(grupo => {
            const d = data[grupo];
            const taxa = d.abertos ? (d.encerrados / d.abertos * 100).toFixed(1) : 0;
            const tempo = d.tempos.length ? (d.tempos.reduce((a, b) => a + b) / d.tempos.length).toFixed(1) : 0;
            const tr = document.createElement('tr');
            tr.innerHTML = `<td><strong>${grupo}</strong></td><td style="text-align: center;"><span class="badge badge-orange">${d.abertos}</span></td><td style="text-align: center;"><span class="badge badge-teal">${d.encerrados}</span></td><td style="text-align: center;"><strong style="color:${app.config.colorOrange}">${taxa}%</strong></td><td style="text-align: center;"><strong>${tempo}h</strong></td><td style="text-align: center;"><strong>${app.config.efficiencyTarget}%</strong></td>`;
            tbody.appendChild(tr);
        });
    }

    function destroyChart(id) {
        if (app.charts[id]) {
            app.charts[id].destroy();
            app.charts[id] = null;
        }
    }

    function clearAllFilters() {
        document.getElementById('mesFilter').value = '';
        document.getElementById('diaFilter').innerHTML = '<option value="">Todos</option>';
        document.getElementById('ativoFilter').value = '';
    }

    function showError(msg) {
        const el = document.getElementById('error');
        el.textContent = msg;
        el.style.display = 'block';
        setTimeout(() => { el.style.display = 'none'; }, 5000);
    }

    function showSuccess(msg) {
        const el = document.getElementById('success');
        el.textContent = msg;
        el.style.display = 'block';
        setTimeout(() => { el.style.display = 'none'; }, 3000);
    }

    const painelCharts = [
        {name: 'Di√°rio - Abertos vs Encerrados', chart: 'chart1'},
        {name: 'Mensal - Consolidado', chart: 'chart2'}
    ];

    function startPanelRotation() {
        if (app.painelTimer) return;
        rotatePanelChart();
        app.painelTimer = setInterval(rotatePanelChart, app.config.rotationTime);
    }

    function stopPanelRotation() {
        if (app.painelTimer) {
            clearInterval(app.painelTimer);
            app.painelTimer = null;
        }
    }

    function rotatePanelChart() {
        const sourceChart = app.charts[painelCharts[app.painelChartIndex].chart];
        if (!sourceChart) {
            app.painelChartIndex = (app.painelChartIndex + 1) % painelCharts.length;
            return;
        }
        const painelCanvas = document.getElementById('painelChart');
        const painelCtx = painelCanvas.getContext('2d');
        destroyChart('painelChart');
        const chartConfig = sourceChart.config;
        app.charts.painelChart = new Chart(painelCtx, {type: chartConfig.type, data: JSON.parse(JSON.stringify(chartConfig.data)), options: JSON.parse(JSON.stringify(chartConfig.options)), plugins: [chartLabelsPlugin]});
        document.getElementById('painelChartTitle').textContent = painelCharts[app.painelChartIndex].name;
        app.painelChartIndex = (app.painelChartIndex + 1) % painelCharts.length;
        startCountdown();
    }

    function startCountdown() {
        app.painelCountdown = app.config.rotationTime / 1000;
        updateCountdown();
        if (app.painelCountdownInterval) clearInterval(app.painelCountdownInterval);
        app.painelCountdownInterval = setInterval(() => {
            app.painelCountdown--;
            if (app.painelCountdown < 0) app.painelCountdown = app.config.rotationTime / 1000;
            updateCountdown();
        }, 1000);
    }

    function updateCountdown() {
        document.getElementById('painelTimer').textContent = app.painelCountdown + 's';
    }
    </script>
</body>
</html>
